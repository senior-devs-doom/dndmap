<!DOCTYPE html>
<html>
<head>
<!--
 * ----------------------------------------------------------------------------
 * "THE BEER-WARE LICENSE" (Revision 42):
 * Karol Chruzik wrote this file. As long as you retain this notice you
 * can do whatever you want with this stuff. If we meet some day, and you think
 * this stuff is worth it, you can buy me a beer in return. 
 * ----------------------------------------------------------------------------
-->
	<title>Battle Grid</title>
	</script>
	<style>
	*{
	background-size: cover;
	}
	header *{
	color:white;	
	}
	header h1{
	margin-bottom:0;
	}
	header p{
	margin-top:0;
	margin-bottom:20px;
	}
	header p a{
	margin-left:0;
	margin-right:10px;
	font-size:15px;
	}
	header p a:hover{
	color:gray;
	}
	body{
	background-image: url("gui/background.jpg");
	background-size: auto;
	}
	.amigo{
	border: 1px solid green;
	}
	.neutral{
	border: 1px solid gray;
	}
	.notamigo{
	border: 1px solid red;
	}
	.character p{
	pointer-events: none;
	-webkit-text-stroke: 0.4px black;
	z-index:100;
	}
	.addaguy{
	padding:20px;
	width:580px;
	background-image: url("gui/background2.jpg");
	}
	.movement, #Area, #AreaC{
	display:none;
	}
	.movementShow{
	border:4px dashed black;
	border-radius: 50%;
	position:absolute;
	box-sizing: border-box;
	z-index:0;
	}
	.bulkY,.bulkX{
	display:none;
	}
	#menu{
	margin:10px;
	margin-top:6px;
	position:fixed;
	width:3%;
	top:0;
	right:0;
	z-index:150;
	}
	.menubutton{
	border-radius:50%;
	font-size:0px;
	margin:3px;
	width:100%;
	height:var(--buttonheight);
	background-size: contain;
	}
	.menubutton p{
	font-size:12px;
	color:white;
	font-weight:bold;
	pointer-events:none;
	}
	#moveBulk{
	z-index:200;
	position:absolute;
	border:2px solid blue;
	background-color:#33ccff;
	opacity:30%;
	font-size:0px;
	}
	#changeStat{
	position:absolute;
	margin:0;
	padding:10px;
	width:180px;
	background-image: url("gui/background2.jpg");
	text-align:center;
	}
	#changeStat *{
	-webkit-text-stroke:0;
	margin:0;
	padding:0;
	}
	#loadingScreenBackground{
	background-color:black;
	position:fixed;
	margin:0;
	left:0;
	top:0;
	width:100%;
	height:100%;
	z-index:199;
	opacity:70%;
	}
	#loadingScreen{
	background-image: url("gui/background2.jpg");
	position:fixed;
	top:20%;
	width:40%;
	left:30%;
	z-index:200;
	}
	#loadingScreen img{
	width:100%;
	}
	#loadingScreen p{
	padding-left:5%;
	font-style: italic;
	}
	#tooltip{
	position:absolute;
	background-image: url("gui/background2.jpg");
	border-radius:15%;
	width:200px;
	z-index:120;
	}
	#tooltip p{
	margin:5px;
	font-style:italic;
	}
	</style>
<link rel="icon" href="gui/logo.png">
<a style='display:none;' id='DontLoadAgain'></a>
</head>
<body onresize="resizeButtons()">
	<header>
		<h1>Battle Grid</h1>
		<p><a target="_blank" href='InitiativeTracker.html'>InitiativeTracker</a> <a target="_blank" href='Settings.html'>Settings</a></p>
	</header>
	<div id='menu' >
		<button class='menubutton' onclick='menuClick()' style="background-image: url('gui/BTNAttackGround.png');">0</button>
		<button class='menubutton' onclick='menuClick()' style="background-image: url('gui/BTNStun.png');">6</button>
		<button class='menubutton' onclick='menuClick()' style="background-image: url('gui/BTNAmbush.png');">4</button>
		<button class='menubutton' onclick='menuClick()' style="background-image: url('gui/BTNCorpseExplode.png');">3</button>
		<button class='menubutton' onclick='menuClick()' style="background-image: url('gui/BTNUnload.png');">5</button>
		<button class='menubutton' onclick='menuClick()' style="background-image: url('gui/BTNBansheeMaster.png');">2</button>
		<button class='menubutton' onclick='diceClick()' style="background-image: url('gui/D4.png');"> <a>4</a> <p>D4</p></button>
		<button class='menubutton' onclick='diceClick()' style="background-image: url('gui/D6.png');"> <a>6</a> <p>D6</p></button>
		<button class='menubutton' onclick='diceClick()' style="background-image: url('gui/D8.png');"> <a>8</a> <p>D8</p></button>
		<button class='menubutton' onclick='diceClick()' style="background-image: url('gui/D10.png');"><a>10</a><p>D10</p></button>
		<button class='menubutton' onclick='diceClick()' style="background-image: url('gui/D12.png');"><a>12</a><p>D12</p></button>
		<button class='menubutton' onclick='diceClick()' style="background-image: url('gui/D20.png');"><a>20</a><p>D20</p></button>
	</div>
	<main id="main">
	
	</main>
	<br/>
	<button class="fogon" onclick="FogOn()">Fog on war</button>
	<button class="fogoff" onclick="FogOff()">Fog off war</button>
	<br/><br/>
	<div class="addaguy">
		<label>Name</label>
		<input id="FreshName"></input>
		<button onclick='clickFile()'><input type="file" style='display:none;' id='selectCharacter'>Choose file</button>
		<label>Size</label>
		<select id="FreshSize" >
			<option value="tiny">tiny</option>
			<option value="medium" selected="selected">medium</option>
			<option value="large">large</option>
			<option value="huge">huge</option>
			<option value="gargantuan">gargantuan</option>
		</select>
		<select id="FreshAmigo" >
			<option value="amigo">Amigo</option>
			<option value="neutral">Neutral</option>
			<option value="notamigo" selected="selected">NotAmigo</option>
			<option value="none">none</option>
		</select>
		<label>Movement :</label>
		<input id="FreshMovement" type="number" style="width:50px;" value="30" ></input>
		<label>Color:</label>
		<input id="FreshMovementC"  style="width:50px;" value="black" ></input>
		<br/>
		<label>Movement2:</label>
		<input id="FreshMovement2" type="number" style="width:50px;"  ></input>
		<label>Color:</label>
		<input id="FreshMovement2C"  style="width:50px;" value="#2CC4D0" ></input>
		<br/>
		<label>Movement3:</label>
		<input id="FreshMovement3" type="number" style="width:50px;"  ></input>
		<label>Color:</label>
		<input id="FreshMovement3C"  style="width:50px;" value="brown" ></input>
		<br/>
		<label>Area:</label>
		<input id="FreshArea" type="number" style="width:50px;"  ></input>
		<label>Color:</label>
		<input id="FreshAreaC"  style="width:50px;" value="red" ></input>
		<br/><br/>
		<button id='addaguyB' style="margin-left:40%;" onclick="AddAGuy()">add a guy</button>
	</div>
	<div>
	<br/>
		<button onclick="saveGrid()">Save</button>
	</div>
	
</body>
<script>
function FogOn(){//covers map in fog squares
	var left=document.getElementById('main').offsetLeft;
	var top=document.getElementById('main').offsetTop;
	var fogSize=fogDensity*squareSize;
	document.body.innerHTML+="<div id='loadingScreenBackground'></div><div id='loadingScreen'><img src='gui/loading.gif'><p>Loading battle fog, this might take a while...</p></div>"
	setTimeout(function(){//needs a small break so the site can load loading image before it loads more loadout.
		while(top<=mapHeight+document.getElementById('main').offsetTop){
			document.getElementById("main").innerHTML+="<div class='FogOfWar' onclick='event.target.remove();' onmouseover='Light()' style='top:"+top+"px;left:"+left+"px;'></div>";
			if(left+fogSize<mapWidth){
				left+=fogSize;
			}
			else{
				left=document.getElementById('main').offsetLeft;
				top+=fogSize;
			}
		}
		document.getElementById("loadingScreen").remove();
		document.getElementById("loadingScreenBackground").remove();
		}
	,25);//funnily enough 20 sec doesnt give him enough tiem to load gif sometimes. cant be arsed to make himm wait till gif loads lol
}
function FogOff(){//anihilates fog squares
	while(document.getElementsByClassName("FogOfWar").length!=0){
	document.getElementsByClassName("FogOfWar")[0].remove();
	}
}
function Light(){//destroys fog tile when mouse hovers it with pressed left click
	if(mouseDown){
		event.target.remove();
	}
}
function getSize(pieceClass){//returns radius of the character in pixels
	var size=squareSize/2;//medium size
	if(/tiny/.test(pieceClass))
		size/=2;
	if(/large/.test(pieceClass))
		size*=2;
	if(/huge/.test(pieceClass))
	size*=3;
	if(/gargantuan/.test(pieceClass))
		size*=4;
	return size;
}
function getSizeCustom(string){//same as above only from string like "15ft."
		regex = new RegExp("ft.");
		var end = string.search(regex);
		var start = end-1;
		while(parseInt(string[start])||string[start]=="."||string[start]=="0"){//that zero=false gave me a scare
			start--;
		}
		return parseFloat(string.slice(start, end))*squareSize/5/2;//holy shit it worked on first time what the fuck?
}		
function fck(){console.log("fuck")}
function clickEvents(){//events that happen when clicking a character
	var piece=event.target;
	var selected=event.button;
	if(menuSelected!=0 && selected==0)//if any option is selected from menu and user clicked left click button
		selected=menuSelected;
	if(selected==0){//moving the character
		if(moving){//second click that selects where you want to move the character 
			if(!movingBulk){//when selecting a single character
				moving=false;
				var characterID=document.getElementById('moveIt').getElementsByClassName("characterID")[0].id;			
				var size=getSize(document.getElementById('moveIt').className);
				regex=new RegExp("medium");
				if(size==25 && !regex.test(document.getElementById('moveIt').className))//custom size
					size=getSizeCustom(document.getElementById('moveIt').className);
				//walking is bit scuffed. if you want to revert it uncomment two lines here and comment setInterval.
				//document.getElementById('moveIt').style.top=event.pageY-size;
				//document.getElementById('moveIt').style.left=event.pageX-size;
				document.getElementById('moveIt').style.boxShadow='';
				var finalX=event.pageX-size;
				var finalY=event.pageY-size;
				var disttickX=(finalX-(parseInt(document.getElementById('moveIt').style.left))) / (1000/60);
				var disttickY=(finalY-(parseInt(document.getElementById('moveIt').style.top)))  / (1000/60);
				const walkingIntr=setInterval(function(){walking(document.getElementById(characterID).parentNode,disttickX,disttickY,finalX,finalY,walkingIntr)}, (1000/60));
				document.getElementById('moveIt').id=null;
				while(document.getElementById('deletedis'))
					document.getElementById('deletedis').remove();//delete movement cricles
				if(document.getElementById('Areaof'+characterID)){//this moves area circle
					var area=document.getElementById('Areaof'+characterID);
					var FinalXArea=event.pageX-parseInt(area.style.width)/2;
					var finalYArea=event.pageY-parseInt(area.style.height)/2;
					const walkingIntrArea=setInterval(function(){walking(area,disttickX,disttickY,FinalXArea,finalYArea,walkingIntrArea)}, (1000/60));
				}
				return 0;
			}
			else{//when selecting multiple characters
				movingBulk=false;
				moving=false;
				var characters=document.getElementsByClassName('moveBulk');
				var repetition=characters.length;//I can't use length of array directly, as array is slowly getting obliterated.
				//yes you can simplify by just changing loop to while(characters) but after its done it throws out error. and errors are ugly!
				var pY=event.pageY;
				var pX=event.pageX;
				for(var i=0;i<=repetition-1;i++){
					setTimeout(function(){
						var thisGuy=characters[0].getElementsByClassName('characterID')[0].parentNode;
						var size =getSize(characters[0].className);
						var distX=parseInt(characters[0].getElementsByClassName("bulkX")[0].innerHTML);
						var distY=parseInt(characters[0].getElementsByClassName("bulkY")[0].innerHTML);
						var finalY=pY-size+distY;
						var finalX=pX-size+distX;
						var disttickX=(finalX-(parseInt(characters[0].style.left))) / (1000/60);
						var disttickY=(finalY-(parseInt(characters[0].style.top)))  / (1000/60);
						var walkingInt=setInterval(function(){walking(thisGuy,disttickX,disttickY,finalX,finalY	,walkingInt)}, (1000/60));
						characters[0].style.boxShadow='';console.log(walkingInt);
						characters[0].getElementsByClassName("bulkX")[0].remove();
						characters[0].getElementsByClassName("bulkY")[0].remove();
						characters[0].className=characters[0].className.substring(0, characters[0].className.length - 9);//deletes moveBulk from class
					}, 55*i);
				}
			}
		}
		if(!moving && piece.className.slice(0, 9)=='character'){//first click that selects character you want to move 
			moving=true;
			piece.id="moveIt";
			piece.style.boxShadow='2px 2px 10px 12px rgba(0,0,0,0.8)';
			//this creates circle that shows movement
			var size=getSize(event.target.className);
			const movement=event.target.getElementsByClassName('movement');
			document.getElementById('main').appendChild(makeCircle(event.target,parseInt(movement[0].innerHTML),movement[3].innerHTML,size));
			if(movement[1].innerHTML!="")
			document.getElementById('main').appendChild(makeCircle(event.target,parseInt(movement[1].innerHTML),movement[4].innerHTML,size));
			if(movement[2].innerHTML!="")
			document.getElementById('main').appendChild(makeCircle(event.target,parseInt(movement[2].innerHTML),movement[5].innerHTML,size));
			
		}
	}
	if(selected==2){//shows statistics and descriptions
		if(piece.className.slice(0, 9)=='character'){//create window to edit clicked character stats
			if(!document.getElementById('changeStat')){//this if is for avoiding stacking
				var div=document.createElement('div');
				var sizePixels=getSize(piece.className);
				var name=piece.getElementsByTagName('P')[0].innerHTML;
				var image=piece.style.backgroundImage.slice(5,piece.style.backgroundImage.length-2);
				var movement=piece.getElementsByTagName('P');
				var amigo=piece.className.slice(10,piece.className.length);//I get amigo and size at once then split em
				for(var i=amigo.length-1;amigo[i]!=' ';i--){}
				var size=amigo.slice(i+1,amigo.length);
				amigo=amigo.slice(0,i)

				div.id='changeStat';
				div.style.left=parseInt(piece.style.left)+2*sizePixels+'px';
				div.style.top=parseInt(piece.style.top)+'px';
				div.style.zIndex=190;
				div.innerHTML='<p>'+name+'</p><label>Name:</label><input value='+name+'></input>';
				div.innerHTML+='<label>Image:</label><input value='+image+'></input>';
				div.innerHTML+='<label>Border:</label><input value='+amigo+'></input>';
				div.innerHTML+='<label>Size:</label><input value='+size+'></input>';
				div.innerHTML+='<label>Movement1:</label></br><input style="width:45%" value='+movement[1].innerHTML+'></input><input style="width:45%" value='+movement[4].innerHTML+'></input>';
				div.innerHTML+='<label>Movement2:</label></br><input style="width:45%" value='+movement[2].innerHTML+'></input><input style="width:45%" value='+movement[5].innerHTML+'></input>';
				div.innerHTML+='<label>Movement3:</label></br><input style="width:45%" value='+movement[3].innerHTML+'></input><input style="width:45%" value='+movement[6].innerHTML+'></input>';
				div.innerHTML+='<label>Area:</label></br><input style="width:45%" value='+     movement[7].innerHTML+'></input><input style="width:45%" value='+movement[8].innerHTML+'></input>';
				document.getElementById('main').appendChild(div);
				div.addEventListener('keyup',updateStats);
				document.body.addEventListener('mousedown',removeStatBlock);
				event.target.innerHTML+='<a id="changingStats"></a>'//this guy is here so I can find the div
			}
		}
	}
	if(selected==3 && piece.className.slice(0, 9)=='character'){
		moving=false;
		event.target.remove();
		while(document.getElementById('deletedis'))
			document.getElementById('deletedis').remove();
	}
	if(selected==4 && piece.className.slice(0, 9)=='character'){
		if(event.target.style.opacity!=0.02)
			event.target.style.opacity=0.02;
		else
			event.target.style.opacity=1;
	}
	if(selected==6 && piece.className.slice(0, 9)=='character'){
		if(event.target.style.opacity!=0.5){
			event.target.style.opacity=0.5;
			event.target.style.zIndex=1;
		}
		else{
			event.target.style.opacity='';
			event.target.style.zIndex="";
		}
	}	
}
function moveinBulk(){
	var selected=event.button;
	if(menuSelected!=0 && selected==0)//when any option is selected from menu and user clicked left click button
		selected=menuSelected;
	if(selected==5){
		if(mouseDown==true){
			if(!document.getElementById('moveBulk')){
				var moveBulk=document.createElement('div');
				moveBulk.id='moveBulk';
				moveBulk.innerHTML='<p>'+event.pageY+'</p><p>'+event.pageX+'</p>';
				document.getElementById('main').appendChild(moveBulk);
			}
			else{
				var div = document.getElementById('moveBulk');
				var corner1Y = div.children[0].innerHTML;
				var corner1X = div.children[1].innerHTML;
				var corner2Y = event.pageY;
				var corner2X = event.pageX;
				if(corner1Y > corner2Y){
					div.style.top = corner2Y+'px';
					div.style.height = corner1Y - corner2Y+'px';
				}
				else{
					div.style.top = corner1Y+'px';
					div.style.height =	corner2Y - corner1Y+'px';					
				}
				if(corner1X > corner2X){
					div.style.left = corner2X+'px';
					div.style.width = corner1X - corner2X+'px';
				}
				else{
					div.style.left = corner1X+'px';
					div.style.width = corner2X - corner1X+'px';			
				}
				
			}
		}
		else{
			if(document.getElementById('moveBulk')){
				var characters=document.getElementsByClassName('character');
				var area=document.getElementById('moveBulk');
				var minY=parseInt(area.style.top);
				var maxY=minY + parseInt(area.style.height);
				var midY=minY + (parseInt(area.style.height)/2);
				var minX=parseInt(area.style.left);
				var maxX=minX + parseInt(area.style.width);
				var midX=minX + (parseInt(area.style.width)/2);
				for(var i=0;i<characters.length;i++){
					var size=getSize(characters[i].className);
					var chY=parseInt(characters[i].style.top)+size;
					var chX=parseInt(characters[i].style.left)+size;
					if(chY>=minY && chY<=maxY  &&  chX>=minX && chX<=maxX){
						var distanceX=parseInt(characters[i].style.left)+size-midX;//distance from middle of movebulk square
						var distanceY=parseInt(characters[i].style.top)+size-midY;
						characters[i].className+=' moveBulk';
						characters[i].style.boxShadow='2px 2px 10px 12px rgba(0,0,0,0.8)';
						characters[i].innerHTML+="<a class='bulkX'>"+distanceX+"</a><a class='bulkY'>"+distanceY+"</a>"
						moving=true;
						movingBulk=true;
					}
				}
				document.getElementById('moveBulk').remove();
				document.getElementsByClassName('menubutton')[0].click();
			}
		}
	}
}
function removeStatBlock(){
	//If the user haven't clicked stat block or its child. I used XOR: !( a || b)
	if(!(event.target==document.getElementById('changeStat') || event.target.parentNode==document.getElementById('changeStat'))){
		document.body.removeEventListener('mousedown',removeStatBlock);
		document.getElementById('changeStat').removeEventListener('keyup',updateStats);
		document.getElementById('changingStats').remove();
		document.getElementById('changeStat').remove();
	}
}
function updateStats(){//moves statblock inputs on character
	var character=document.getElementById('changingStats').parentNode;
	var block=document.getElementById('changeStat').getElementsByTagName('input');
	var id=character.getElementsByClassName("characterID")[0].id;
	character.getElementsByTagName('P')[0].innerHTML=block[0].value;
	character.style.backgroundImage='url('+block[1].value+')';
	character.className='character '+block[2].value+' '+block[3].value;
	var regex = new RegExp("^[0-9|.]+$");
	if(regex.test(block[3].value))//if there are only numbers in size
		character.className+="ft.";//add ft.
	character.getElementsByTagName('P')[1].innerHTML=block[4].value;
	character.getElementsByTagName('P')[2].innerHTML=block[6].value;
	character.getElementsByTagName('P')[3].innerHTML=block[8].value;
	character.getElementsByTagName('P')[4].innerHTML=block[5].value;
	character.getElementsByTagName('P')[5].innerHTML=block[7].value;
	character.getElementsByTagName('P')[6].innerHTML=block[9].value;
	character.getElementsByTagName('P')[7].innerHTML=block[10].value;
	character.getElementsByTagName('P')[8].innerHTML=block[11].value;
	if(document.getElementById("Areaof"+id))//delete area
		document.getElementById("Areaof"+id).remove();
	if(character.children[7].innerHTML){//make area
		var Areamarker = makeCircle(character,character.children[7].innerHTML,character.children[8].innerHTML,getSize(character.className));
		Areamarker.id = 'Areaof'+character.children[9].id;
		document.getElementById('main').appendChild(Areamarker);
	}
	regex = new RegExp("tiny|medium|large|huge|gargantuan");
	if(!regex.test(character.className)){//has no standard size
		var newSize=getSizeCustom(character.className);
		character.style.width=newSize*2+'px';
		character.style.height=newSize*2+'px';
		character.getElementsByTagName("P")[0].style.paddingTop=newSize*2+"px";
		character.getElementsByTagName("P")[0].style.marginTop="0px";
	}
	else{
	character.style.width='';
	character.style.height='';
	character.getElementsByTagName("P")[0].style.paddingTop="";
	character.getElementsByTagName("P")[0].style.marginTop="";
	}
}
function styles(){//on load creates styles. Has to be dynamic cause of the 'size' variable used in style
//this solution is dogshit ever since I learned css has variables :0
//can't be arsed to update it doe
var style = document.createElement('style');
style.type = 'text/css';
style.innerHTML +='	.FogOfWar{width:'+fogDensity*squareSize+'px;height:'+fogDensity*squareSize+'px;background-color:black;float:left;position:absolute;opacity:'+fogOpacity+';margin:0px;z-index:110;}  ';
style.innerHTML +='	.character{width:'+squareSize+'px;height:'+squareSize+'px;border-radius: 50%;position:absolute;box-sizing: border-box;z-index:80;}  ';
style.innerHTML +=' .character p{padding-top:'+squareSize*0.5+'px;font-size:'+squareSize*0.4+'px;color:white;text-align:center;z-index:100;}  ';
style.innerHTML +=' .tiny{width:'+squareSize/2+'px;height:'+squareSize/2+'px;border-radius: '+squareSize/2+'px;z-index:90;}  ';
style.innerHTML +=' .large{width:'+squareSize*2+'px;height:'+squareSize*2+'px;border-radius: '+squareSize*2+'px;z-index:70;}  ';
style.innerHTML +=' .huge{width:'+squareSize*3+'px;height:'+squareSize*3+'px;border-radius: '+squareSize*3+'px;z-index:60;}  ';
style.innerHTML +=' .gargantuan{width:'+squareSize*4+'px;height:'+squareSize*4+'px;border-radius: '+squareSize*4+'px;z-index:50;}  ';
style.innerHTML +=' .tiny p{padding-top:'+squareSize*0.2+'px;font-size:'+squareSize*0.35+'px;}';
style.innerHTML +=' .large p{padding-top:'+squareSize*1.2+'px;font-size:'+squareSize*0.7+'px;}';
style.innerHTML +=' .huge p{padding-top:'+squareSize*1.6+'px;font-size:'+squareSize*1.2+'px;}';
style.innerHTML +=' .gargantuan p{padding-top:'+squareSize*2+'px;font-size:'+squareSize*1.7+'px;}';
document.getElementsByTagName('head')[0].appendChild(style);

}
function AddAGuy(){//creates a character
var name = document.getElementById("FreshName").value;
var movement = [[document.getElementById("FreshMovement").value,document.getElementById("FreshMovementC").value],[document.getElementById("FreshMovement2").value,document.getElementById("FreshMovement2C").value],[document.getElementById("FreshMovement3").value,document.getElementById("FreshMovement3C").value]];
var size = document.getElementById("FreshSize").value;
var amigo= document.getElementById("FreshAmigo").value;
var path="characters/"+name+imagesFormat;
var guy = document.createElement("DIV");
var names=document.getElementsByClassName("character")
var guyID=getNewID();
var koledzy=1;
var duplicate=false;
var top=parseInt(document.getElementById('main').style.height)+160+Math.floor(Math.random() * 121)+'px';
var left=parseInt(getComputedStyle(document.querySelector('.addaguy'))['width'])+50+Math.floor(Math.random() * 301)+'px';
if(imagesFormat=='' && name.indexOf(".")!=-1){//slice the file extension when user has to input full name.
	for(var i=name.length;name[i]!='.';i--){}
	name=name.substring(0,i);
}
for(i=0;i<=names.length-1;i++){//if character named like that is already on the field
	var regex = new RegExp(name);
	if(regex.test(names[i].firstChild.innerHTML)){
		koledzy++;
		duplicate=true;
	}
}
if(duplicate){//add to name number of duplicate
	name+=koledzy;
}
//have to add a loop that make sure these dont duplicate too
//for example currently if you have kobold1 and kobold2, you delete kobold1 then it will create kobold2 again
guy.className='character ' + amigo +" " + size ;
guy.style.backgroundImage='url('+path+')';
guy.style.top=top;
guy.style.left=left;
guy.innerHTML='<p>'+name+'</p>';
guy.innerHTML+="<p class='movement'>"+movement[0][0]+'</p>'; 
guy.innerHTML+="<p class='movement'>"+movement[1][0]+'</p>'; 
guy.innerHTML+="<p class='movement'>"+movement[2][0]+'</p>'; 
guy.innerHTML+="<p class='movement'>"+movement[0][1]+'</p>'; 
guy.innerHTML+="<p class='movement'>"+movement[1][1]+'</p>'; 
guy.innerHTML+="<p class='movement'>"+movement[2][1]+'</p>'; 
guy.innerHTML+="<p id='Area'>"+document.getElementById('FreshArea').value+'</p>';
guy.innerHTML+="<p id='AreaC'>"+document.getElementById('FreshAreaC').value+'</p>';
guy.innerHTML+="<a class='characterID' id="+guyID+"></a>";
document.getElementById('main').appendChild(guy);
if(guy.children[7].innerHTML){
	var Areamarker = makeCircle(guy,guy.children[7].innerHTML,guy.children[8].innerHTML,getSize(guy.className));
	Areamarker.id = 'Areaof'+guy.children[9].id;
	document.getElementById('main').appendChild(Areamarker);
	}
}
function clickFile(){//input type file is bit scuffed, dont even know if its possible to change it well with CSS, so please support it in its transition to a button.
	//This is still scuff btw, the function activates twice first from button then itself from input. freaking inheritence, I'd rather just add an extra if then prevent it doe..
	if(event.target.nodeName!='INPUT')
		event.target.children[0].click();
}
function selectCharacter(){//for selecting name from directory directly
	var name=event.target.value.slice(12);
	if(imagesFormat!=''){//slice the file extension
		for(var i=name.length;name[i]!='.';i--){}
		name=name.substring(0,i);
	}
	document.getElementById('FreshName').value=name;
}
function loadCharacters(){//loads the preset characters at page load
var left=-45+parseInt(squareSize)+1+'px';//this declaration is scuffed, can't be arsed.
var top=45+parseInt(squareSize)+1+'px';
for(var i=0;i<=preChar.length-1;i++){
	var guy=document.createElement('div');
	guy.className='character '+preChar[i][3]+' '+preChar[i][2];
	guy.style="background-image: url('characters/"+preChar[i][0]+imagesFormat+"');z-index:100;";//since its party I asssume they all important and give em biggest z-index
	guy.style.top=top;
	guy.style.left=left;
	left=parseInt(left)+parseInt(squareSize)+5+'px';
	guy.innerHTML="<p>"+preChar[i][0]+"</p><p class='movement'>"+preChar[i][1]+"</p>";
	guy.innerHTML+='<p class="movement"></p><p class="movement"></p><p class="movement">black</p><p class="movement">#2CC4D0</p><p class="movement">brown</p><p id="Area"></p><p id="AreaC">red</p>';
	guy.innerHTML+="<a class='characterID' id="+getNewID()+"></a>";
	document.getElementById('main').appendChild(guy);
}
}
function menuClick(){//for clicking on any button in menu
	if(menuSelected!=event.target.innerHTML){
		menuSelected=parseInt(event.target.innerHTML);
		document.body.style.cursor = "url('gui/"+menuSelected+".png'), auto";
	}
	else{
		menuSelected=0;
		document.body.style.cursor='';
	}
}
function keyShortcut(){//use keyboard to push menu buttons
	if(event.target.tagName=="BODY"){
		var key=parseInt(event.key);
		if(key<=document.getElementsByClassName('menubutton').length)
			document.getElementsByClassName('menubutton')[key-1].click();
		document.body.click();
	}
}
function saveGrid(){//the simplest way to save current setup, as seperate file. what could go wrong?
	var content= document.children[0].innerHTML;
	var title= prompt("Enter how you'd like to name the save", "Last Session");
	var file = new File([content], title+".html");
	var url = URL.createObjectURL(file);
	var a = document.createElement("a");
	a.href = url;
    a.download = title+".html";
	a.innerHTML='hi';
    document.body.appendChild(a);
	a.click();
	a.remove();
}
function resizeButtons(){//button size changing when window size changes
document.documentElement.style.setProperty('--buttonheight', window.innerWidth/100*3+"px");
}
function getNewID(){//months into project I relize having ID's might be neat hahaha... 
	//If you want to hate, hate I just put shit in div's instead of making an actual object
	//I swear I will modernize old code one of those days...
	var i=0;
	while(document.getElementById("characterID:"+i))//looks for closest untaken ID
		i++;
	return "characterID:"+i;
}
function walking(thisGuy,disttickX,disttickY,finalX,finalY,IntNr){//moving animation in crisp 60 frames kappa
	thisGuy.style.left=parseInt(thisGuy.style.left)+disttickX+'px';
	thisGuy.style.top=parseInt(thisGuy.style.top)+disttickY+'px';
	if(Math.abs(disttickX)<1)//if the guy moves less than 1 pixel(stands there like a dumbass)
		thisGuy.style.left=finalX+'px';
	if(Math.abs(disttickY)<1)
		thisGuy.style.top=finalY+'px';
	if(disttickY>0){//if he goes past his Y destination move him back
		if(parseInt(thisGuy.style.top)>finalY)
			thisGuy.style.top=finalY+'px';
	}
	else{
		if(parseInt(thisGuy.style.top)<finalY)
			thisGuy.style.top=finalY+'px';
	}
	if(disttickX>0){//if he goes past his X destination move him back
		if(parseInt(thisGuy.style.left)>finalX)
			thisGuy.style.left=finalX+'px';
	}
	else
		if(parseInt(thisGuy.style.left)<finalX)
			thisGuy.style.left=finalX+'px';
	if(parseInt(thisGuy.style.left)==Math.floor(finalX) && parseInt(thisGuy.style.top)==Math.floor(finalY))//you've arrived at your destination
		clearInterval(IntNr);
}
function diceClick(){//rolls the fixed dice on the right
	var henry=event.target
	henry.children[1].innerHTML=Math.floor(Math.random() * henry.children[0].innerHTML) + 1;
	setTimeout(function(){diceClick2(henry)},100);
	setTimeout(function(){diceClick2(henry)},200);
	setTimeout(function(){diceClick2(henry)},400);
	setTimeout(function(){diceClick2(henry);henry.children[1].style.transition="0s";henry.children[1].style.color="orange";},500);
	setTimeout(function(){henry.children[1].style.transition="0.7s";henry.children[1].style.color="white";},530);
}
function diceClick2(henry){
	henry.children[1].innerHTML=Math.floor(Math.random() * henry.children[0].innerHTML) + 1;
}
function makeCircle(guy,movement,color,size){//all these squares make a circle, border radius gap + didn't ask + ratio
	var range=document.createElement("div");
	var regex=  new RegExp('medium');
	if(size==25 && !regex.test(guy.className))//custom size
		size=getSizeCustom(guy.className)
	range.className="movementShow";
	range.id="deletedis"
	range.style.width=(2*(movement*(squareSize/5)+size))-50+'px';
	range.style.height=range.style.width;
	range.style.top=parseInt(guy.style.top) - (parseInt(range.style.width)/2-size)+'px';
	range.style.left=parseInt(guy.style.left) - (parseInt(range.style.height)/2-size)+'px';
	range.style.borderColor=color;
	return range;
}
function tooltip(){//short div with description of shit mouse is hovered over
	if(menuSelected==2){
		var desc='';
		if(!event.target.className)
			return 0;
		switch(event.target.className) {
			case 'fogon':
				desc='Creates fog to cover the dungeon from players';
			break;
			case 'fogoff':
				desc='Removes fog created by guy on the left';
			break;
			case 'addaguy':
				desc='Menu for adding more characters';
			break;
			case 'menubutton':
				desc='menubuttons';
				switch(event.target.innerHTML) {
					case '0':
						desc='Moves a character (default)';
					break;
					case '2':
						desc='You want description for a thing that gives descriptions? Anywho, click a character to change their stats';
					break;
					case '3':
						desc='Destroys the character';
					break;
					case '4':
						desc='Hides the character (just remember where you put it)';
					break;
					case '5':
						desc='Moves multiple characters (hold n drag then click)';
					break;
					case '6':
						desc='Makes character half-transparent (I use it to mark corpses/unconsious)';
					break;
					default:
						desc='Rolls sum dice';
				}
			break;
		}
		if(desc=='')
			return 0;
		if(!document.getElementById('tooltip') && desc!=''){
			var tooltip=document.createElement("div");
			tooltip.id='tooltip';
			document.getElementById('main').appendChild(tooltip)
		}
		document.getElementById('tooltip').innerHTML="<p>"+desc+"</p>";
	}
}
function tooltipmove(){//moves and removes tooltip
	if(document.getElementById('tooltip')){//this solution is kinda bad, tooltip will linger on other divs
	if(menuSelected!=2 || (event.target.constructor.name!="HTMLDivElement" && event.target.constructor.name!="HTMLButtonElement" )){
			document.getElementById('tooltip').remove();
			return 0;
		}
		if(event.pageX+document.getElementById('tooltip').offsetWidth<window.innerWidth)
			document.getElementById('tooltip').style.left=event.pageX+25+'px';
		else
			document.getElementById('tooltip').style.left=event.pageX-1-document.getElementById('tooltip').offsetWidth+'px';
		document.getElementById('tooltip').style.top=event.pageY+1+'px';//adding 1/1 so mouse wont be on it
	}
}
function keyadd(){//adds a guy if you press enter
	if(event.keyCode==13)
		document.getElementById('addaguyB').click();
}
var img = new Image();
img.onload = function() {//creating map
	mapWidth=this.width;
	mapHeight=this.height;
	document.getElementById("main").style.width=mapWidth+"px";
	document.getElementById("main").style.height=mapHeight+"px";
	document.getElementById("main").style.backgroundImage= 'url('+img.src+')';
}
//global variables... its not a sin if I apologize right?
var mapWidth=0;
var mapHeight=0;
var moving=false;
var movingBulk=false;
var mouseDown = false;
var menuSelected=0;
var DontLoadAgain=false;
var x=0;
var y=0;
if(localStorage.getItem('DnDSettings')){//get settings
	eval(localStorage.getItem('DnDSettings'));
}
else{//default settings
	localStorage.setItem('DnDSettings', `
	var map = "CragmawCastle.jpg";
	var imagesFormat = ".jpg";
	var squareSize = "45";
	var fogOpacity = "0.95";
	var fogDensity = "1";
	var visibleColumns= [true,true,true,true,true,false,false,true,true];
	var preChar =[
	["Kairn","30","medium","amigo","d20+4","16","36","humanoid","","twink with a wig. No but seriously, how do I contain whole sentences here?"],
	["Luxaria","30","medium","amigo","d20-1","18","31","humanoid","",""],
	];`);
	eval(localStorage.getItem('DnDSettings'));
}
//when I load from file I dont want to load preset characters again. this flag is in head
if(!document.getElementById('DontLoadAgain').innerHTML)
	loadCharacters();
document.getElementById('DontLoadAgain').innerHTML='true';
styles();
document.body.onmousedown = function() { 
  mouseDown=true;
}
document.body.onmouseup = function() {
  mouseDown=false;
}
img.src = 'maps/'+map;//loading image
document.body.addEventListener('mouseup',clickEvents);
document.body.addEventListener('mousemove',moveinBulk);
document.body.addEventListener('keypress',keyShortcut);
document.getElementById('selectCharacter').addEventListener("change",selectCharacter);
document.body.addEventListener('mouseover',tooltip);
document.body.addEventListener('mousemove',tooltipmove);
document.getElementsByClassName('addaguy')[0].addEventListener("keyup",keyadd);
resizeButtons();
</script>
</html>
